---
title: "Data_Exploration"
author: "Wendel Raymond"
date: "May 6, 2021"
output: html_document
editor_options: 
  chunk_output_type: console
---
## Strait of Juan de Fuca Data Exploration
This script will explore kelp cover and urchin data in the Strait of Juan de Fuca, Washington, USA. Goals are to look for general patterns and/or trends in kelp abundacne and sea urchin harvest.

```{r libraries, echo = FALSE, results = "hide", message = FALSE}
library(tidyverse)

theme_set(theme_classic())
```

### Data
1) Compiled DNR kelp canopy data from 1989 to 2016 georeferenced to WDFW shellfish management areas. Data were extracted from [Pfister et al 2018](https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/1365-2745.12908) and from publically available data at the Washington Department of Fish and Wildlife.

```{r data, echo = FALSE, results = "hide"}
kelp <- read.csv("../Data/kelp_1989_2016_FMA_Ur.csv", header = TRUE, stringsAsFactors = FALSE)
```

#### Data Management
Check data types and preform some transformations.

Structure
```{r data mgmt, echo = FALSE, results = "hide", message = FALSE}
## Check ##
str(kelp)

## Make character version of Map_Index ##
kelp$map_index_ch <- as.character(kelp$map_index)

## Fill blank FMAs (MCRA) and UID with values ##
kelp$MCRA <- ifelse(kelp$MCRA == " ", "U_MCRA", kelp$MCRA)
kelp$UID <- ifelse(kelp$UID == " ", "U_UID", kelp$UID)
```

Transformations
```{r trnsfm, echo = FALSE, results = "hide", message = FALSE}
## Convert to Meters ##
kelp$length_m <- kelp$length_ft * 0.3048
kelp$area_sqm <- kelp$area_sqft * 0.092903

## Convert to Hectare ##
kelp$area_hect <- kelp$area_sqm * 0.0001
```

### Kelp Explore

#### WDFW Urchin Fishing Areas
![](https://wdfw.wa.gov/sites/default/files/styles/page_body_full_width/public/2019-02/urchin.jpg?itok=rIFNmA9l)

#### Summarize by Urchin Fishing Area

Sum kelp area by year and UID
```{r sum1, echo = FALSE, message = FALSE}
kelp.sum <- kelp %>% 
  group_by(year, UID) %>% 
  summarise(total_kelp_hect = sum(area_hect)) %>% 
  mutate(UID_yroyr_mean = mean(total_kelp_hect),
         UID_yroyr_sd = sd(total_kelp_hect),
         total_kelp_anom = (total_kelp_hect - UID_yroyr_mean))
```

Plot - Total kelp area by Urchin Fishing Area
```{r p1.1, echo = FALSE, message = FALSE}
ggplot(kelp.sum) +
  geom_line(aes(x = year, y = total_kelp_hect)) +
  facet_wrap(~UID)
```

Plot - Year over year anomaly of total kelp area by Urchin Fishing Area
```{r p1.2, echo = FALSE, message = FALSE}
ggplot(kelp.sum) +
  geom_line(aes(x = year, y = total_kelp_anom)) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  facet_wrap(~UID)
```

#### Summarize by species and Urchin Fishing Area

Sum kelp area by year, species, and UID
```{r sum2, echo = FALSE, message = FALSE}
kelp.sp.sum <- kelp %>%
  group_by(year, sp_name, UID) %>% 
  summarise(total_kelp_hect = sum(area_hect)) %>% 
  mutate(UID_yroyr_mean = mean(total_kelp_hect),
         UID_yroyr_sd = sd(total_kelp_hect),
         total_kelp_anom = (total_kelp_hect - UID_yroyr_mean))
```

Plot - Total kelp area by species and Urchin Fishing Area 
```{r p2.1, echo = FALSE}
ggplot(kelp.sp.sum) +
  geom_line(aes(x = year, y = total_kelp_hect, color = sp_name)) +
  facet_wrap(~UID)
```

